<div ng-controller="ReviewController" ng-init="reviewed = review.microtask ">

	
    
	<div class="section section-description " >
		
		<div ng-include="'/html/templates/microtasks/microtask_title.html'"></div>

		<div class="section-content job-description" >
			<!-- WRITE TEST CASES -->
			<div ng-if="reviewed.type == 'WriteTestCases'">
				<!-- if function description disputed -->
				<div ng-if="reviewed.submission.isFunctionDispute" >
					The worker was asked to write testcases for the function <strong>{{ reviewed.owningArtifact }}</strong> 
					but he disputed the function description.
				</div>

				<!-- if no function description dispute  AND the prompt type is FUNCTION_SIGNATURE   --> 
				<div ng-if="reviewed.promptType == 'FUNCTION_SIGNATURE' && !reviewed.submission.isFunctionDispute" >
					The worker was asked to write the testcases for the function <strong>{{ reviewed.owningArtifact }}</strong>.
				</div>

				<!-- if no function description dispute  AND the prompt type is CORRECT_TEST_CASES   --> 
				<div ng-if="reviewed.promptType == 'CORRECT_TEST_CASE' && !reviewed.submission.isFunctionDispute" >
					The worker was asked to rewrite the test case
					<strong ng-bind="reviewed.disputedTestCase"></strong>
					that the crowd put in dispute. 
				</div>
			</div>

			<!-- WRITE FUNCTION -->

			<div ng-if="reviewed.type == 'WriteFunction'">
				<div ng-if="reviewed.promptType == 'SKETCH'">
					The worker was asked to edit the code of the function <strong>{{ reviewed.owningArtifact }}</strong>.
				</div>

				<div ng-if="reviewed.promptType == 'RE_EDIT'">
					The worker was asked to edit the signature of the function <strong>{{ reviewed.owningArtifact }}</strong> to address the issue reported by the crowd.
				</div>

				<div ng-if="reviewed.promptType == 'DESCRIPTION_CHANGE'">
					The worker was asked to edit the code of the function <strong>{{ reviewed.owningArtifact }}</strong> after the  signature change of called function .
				</div>

			</div>

			<!-- WRITE TEST -->
			<div ng-if="review.microtask.type == 'WriteTest'">
				
				<div ng-if="! review.microtask.submission.inDispute && ! review.microtask.submission.isFunctionDispute">
					The worker was asked to write a test for the following test case relative 
					to the function <strong>{{functionUnderTest.name}}</strong>
				</div>
				<div ng-if="review.microtask.submission.isFunctionDispute" >
					The worker was asked to write a test for the function
					<strong>{{functionUnderTest.name}}</strong>
					and he reported the function description.
				</div>
				<div ng-if="review.microtask.submission.inDispute" >
					The worker was asked to write a test the following test case relative to the function
					<strong>{{functionUnderTest.name}}</strong>
					but he reported the test case.
				</div>

			</div>

			<!-- WRITE FUNCTION DESCRIPTION -->
			<div ng-if="reviewed.type == 'WriteFunctionDescription'">
				The worker was asked to write a description of the following sketch of function:
			</div>


			<!-- WRITE CALL -->
			<div ng-if="reviewed.type == 'WriteCall'">
				The worker was asked to revise the calls to
				<strong>{{pseudoName}}</strong> in the function
				<strong>{{functName}}</strong>
				<span ng-if="pseudoName!==reviewed.calleeName">with the new implemented function <strong>{{reviewed.calleeName}}</strong>.</span>
			</div>

			<span>Can you rate this work?</span>
		</div>
	</div>

	<div ng-if="reviewed.type == 'WriteFunctionDescription'" class="section section-description">
		<div class="section-title" >
			<div class="dot bg-color"></div>function sketch
		</div>
		<div class="section-content no-padding" >
			<ace-read-js code="review.microtask.callDescription"></ace-read-js>
		</div>
	</div>

	<!--///////////////////////////////////////////-->
	<!--//        WRITE TEST CASES MICROTASK     //-->
	<!--///////////////////////////////////////////-->

	<!-- prompt type = FUNCTION_SIGNATURE -->
	<div ng-if="review.microtask.type == 'WriteTestCases'"> 

		<!-- always show the function description --> 
		<div class="section section-description">
			<div class="section-title" >
				<div class="dot bg-color"></div>function description
			</div>
			<div class="section-content no-padding" >
				<ace-read-js code="review.functionCode"></ace-read-js>
			</div>
		</div>

		<!-- if the function description has been disputed -->
		<div class="section section-review" ng-if="review.microtask.submission.isFunctionDispute">
			<div class="section-title" ><div class="dot bg-color"></div>dispute reason</div>
			<div class="section-content" >
				{{review.microtask.submission.disputeText}}
			</div>
		</div>


		<!-- if the function description has not been disputed -->
		
		<!-- show report data if is a CORRECT_TEST_CASE -->
		<div ng-if="reviewed.promptType == 'CORRECT_TEST_CASE' && !reviewed.submission.isFunctionDispute">
			<div class="section section-description" >
				<div class="section-title" >
					<div class="dot bg-color"></div>
					REPORTED TESTCASE 
				</div>

				<div class="section-content">
					{{reviewed.disputedTestCase}}
				</div>
			</div>

			<div class="section section-description" >

				<div class="section-title" >
					<div class="dot bg-color"></div>
					REPORT EXPLANATION 
				</div>

				<div class="section-content">
					{{reviewed.disputeDescription}}
				</div>	
			</div>

			<div class="section section-description" >
				<div class="section-title" >
					<div class="dot bg-color"></div>
					old test cases
				</div>
				<div class="section-content" >
					<ul style="list-style:none">
						<li class="" ng-repeat="testcase in oldTestCases"><strong>#{{$index+1}}</strong> {{testcase.text}}</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="section section-review" ng-if="!review.microtask.submission.isFunctionDispute">
			<div class="section-title" ><div class="dot bg-color"></div>submitted test cases</div>
			<div class="section-content" >
				<ul style="list-style:none">
					<li class="" ng-repeat="testcase in review.testcases"><strong>#{{$index+1}}</strong> {{testcase.text}}</li>
				</ul>
			</div>
		</div>
	</div>


	<!--//////////////////////////////////////////-->
	<!--//        WRITE FUNCTION MICROTASK      //-->
	<!--//////////////////////////////////////////-->

	<div class="section section-description-2" ng-if="reviewed.disputeText.length > 0">
		<div class="section-title" >
			<div class="dot bg-color"></div>REPORT DESCRIPTION
		</div>
		<div class="section-content" >
			{{reviewed.disputeText}}
		</div>
	</div>


	<div ng-if="reviewed.type == 'WriteFunction' && reviewed.promptType == 'DESCRIPTION_CHANGE'">
		<div class="section section-description-2">
			<div class="section-title" >
				<div class="dot bg-color"></div>different callee function signature
			</div>
			<div class="section-content no-padding" >
				<ace-read-js code="calledDiffCode" mode="diff" ></ace-read-js>
			</div>
		</div>
	</div>


	<div ng-if="review.microtask.type == 'WriteFunction' && (reviewed.promptType == 'RE_EDIT'  || reviewed.promptType == 'DESCRIPTION_CHANGE') ">
		<div class="section section-review">
			<div class="section-title" >
				<div class="dot bg-color"></div>submitted function code
			</div>
			<div class="section-content no-padding" >
				<ace-read-js code="review.functionCode" mode="diff"></ace-read-js>
			</div>
		</div>
	</div>

	<div ng-if="review.microtask.type == 'WriteFunction' && review.microtask.promptType == 'SKETCH'">
		<div class="section section-review">
			<div class="section-title" >
				<div class="dot bg-color"></div>submitted function code
			</div>
			<div class="section-content no-padding" >
				<ace-read-js code="review.functionCode" mode="diff"></ace-read-js>
			</div>
		</div>
	</div>

	<!--//////////////////////////////////////////-->
	<!--//           WRITE TEST MICROTASK       //-->
	<!--//////////////////////////////////////////-->
	<div ng-if="review.microtask.type == 'WriteTest'">
		

		

		<div class="section section-description">
			<div class="section-title" ng-if="!reviewed.submission.isFunctionDispute">
				<div class="dot bg-color"></div>function description
			</div>
			<div class="section-title" ng-if="reviewed.submission.isFunctionDispute">
				<div class="dot bg-color"></div>reported function signature
			</div>
			<div class="section-content no-padding" >
				<ace-read-js code="review.functionCode"></ace-read-js>
			</div>
		</div>


		<div class="section section-description" ng-if="! reviewed.submission.isFunctionDispute">
			<div ng-if="!review.microtask.submission.inDispute" class="section-title" ><div class="dot bg-color"></div>test case</div>
			<div ng-if="review.microtask.submission.inDispute" class="section-title" ><div class="dot bg-color"></div>reported test case</div>
			<div class="section-content" >
				{{reviewed.owningArtifact}}
			</div>
		</div>

		<div ng-if="! reviewed.submission.inDispute && !reviewed.submission.isFunctionDispute" >

			<div class="section section-review">
				<div  class="section-title" ><div class="dot bg-color"></div>submitted TEST</div>
				<div class="section-content" >
					<table style="width:100%" class="test">
						
						<tr ng-repeat="(inputKey,input) in review.microtask.submission.simpleTestInputs track by $index">
							<td>{{functionUnderTest.paramNames[$index]}}</td>
							<td>
								<div ace-read-json ng-model="input" ></div>
							</td>
						</tr>
						<tr ng-if="functionUnderTest.returnType!=undefined">
							<td>test output</td>
							<td>
								<div ace-read-json ng-model="review.microtask.submission.simpleTestOutput" ></div>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div ng-if="review.microtask.submission.inDispute || review.microtask.submission.isFunctionDispute" class="section section-description-2">
			<div class="section-title" ><div class="dot bg-color"></div>report explanation</div>
			<div class="section-content" >
				{{reviewed.submission.disputeText}}
			</div>
		</div>
	</div>




	<!--//////////////////////////////////////////-->
	<!--// WRITE FUNCTION DESCRIPTION MICROTASK //-->
	<!--//////////////////////////////////////////-->
	<div ng-if="review.microtask.type == 'WriteFunctionDescription'">

		<div class="section section-review">
			<div class="section-title" >
				<div class="dot bg-color"></div>submitted function description
			</div>
			<div class="section-content" >
				<ace-read-js code="review.functionCode"></ace-read-js>
			</div>
		</div>
	</div>

	<!--//////////////////////////////////////////-->
	<!--//          WRITE CALL MICROTASK        //-->
	<!--//////////////////////////////////////////-->
	<div ng-if="review.microtask.type == 'WriteCall'">
		
		<div class="section section-description-2">
			<div class="section-title" >
				<div class="dot bg-color"></div>{{reviewed.calleeName}} function signature
			</div>
			<div class="section-content" >
				<ace-read-js code="review.microtask.calleeFullDescription"></ace-read-js>
			</div>
		</div>
		<div class="section section-review">
			<div class="section-title" >
				<div class="dot bg-color"></div>submitted function code
			</div>
			<div class="section-content" >
				<ace-read-js code="review.functionCode" mode="diff"></ace-read-js>
			</div>
		</div>
	</div>

	<alertcontainer></alertcontainer>

	<div class="section-cols" >
		<div class="container-flex-row">
			<div class="section section-help bg-color-alpha" style="width:30%">
				<div class="section-title" >
					<div class="dot"></div>RATING SYSTEM
				</div>
				<div class="section-content" >
					<ul style="list-style:none;margin:0px;padding:0px;">
						<li><b>1 Star</b>: incoherent or unfocussed</li>
						<li><b>2 Star</b>: unconvincing or weak</li>
						<li><b>3 Star</b>: there are some weakness</li>
						<li><b>4 Star</b>: good quality, without weakness</li>
						<li><b>5 Star</b>: excellent without weakness</b></li>
					</ul>

				</div>
				<div class="section-title" >
					<div class="dot"></div>
					AVAILABLE DATA TYPES
				</div>
				<div class="section-content" >
					<adt-list></adt-list>
				</div>
			</div>

			<div class="section section-form" style="width:70%;" >
				<div class="section-content no-padding" >

					<div class="heading-1" >rating</div>
					<div id="ratingsDiv" class="stars-container pull-left" >
						<span ng-repeat="currentValue in [1,2,3,4,5] track by $index"
							  ng-mouseenter="review.mouseOn=currentValue"
							  ng-mouseleave="review.mouseOn=0"
							  ng-click="rate(currentValue)">
							<span class="star {{ ( review.mouseOn > $index || review.rating > $index ) ? 'full' : '' }}"></span>
							<span ng-if="$index == 2" class="stars-separator" ></span>
						</span>
					</div>



					<span class="rating-result pull-left" ng-if="review.rating != -1">
						<strong ng-if="review.rating <= 3"><span class="glyphicon glyphicon-refresh"></span> revise work</strong>  
						<strong ng-if="review.rating > 3"><span class="glyphicon glyphicon-ok"></span> work accepted</strong>  
					</span>

					<span class="clearfix"></div>

					<div class="heading-1" >review</div>
					<textarea
						id="reviewText" class="col-md-12 form-control input-sm" ng-model="review.reviewText" name="reviewText" ng-required="review.rating < 4" focus style="resize:none;height:100px;"></textarea>
					<span
					class="help-block" ng-show="microtaskForm.reviewText.$dirty && review.rating < 4 && microtaskForm.reviewText.$invalid && microtaskForm.reviewText.$error.required">This field is required!</span>
				</div>
			</div>

		</div>
	</div>

</div>

