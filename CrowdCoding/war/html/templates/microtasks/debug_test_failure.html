<div ng-controller="DebugTestFailureController"  >
    

    <div class="section section-description " >
        <div class="section-content no-padding" >
            <ul class="microtask-details clearfix">
                <li class="bg-color">{{::datas.title}}</li>
                <li >
                    <span>{{::datas.submitValue}} points</span>
                </li>
                <li class="color">
                    <div class="help-btn" ng-click="startTutorial('WriteTestCases');"><span class="glyphicon glyphicon-question-sign"></span></div>
                </li>
            </ul>
        </div>
    </div>

    <div class="section section-description">
        <div class="section-title" >
            <div class="dot bg-color"></div>
            JOB DESCRIPTION
        </div>
        <div class="section-content" >
            One (or more) of the tests for the function <strong>{{funct.name}}</strong>  have failed. Can you find and fix the bug(s)?
        </div>
    </div>
    <div class="section section-description" id="functionSignature">
        <div class="section-title" >
            <div class="dot bg-color"></div>
            FUNCTION SIGNATURE
        </div>
        <div class="section-content no-padding" >
            <ace-read-js code="functionDescription"></ace-read-js>
        </div>
    </div>

    <alertcontainer></alertcontainer>

    <div class="section-cols" ng-if="!dispute" >
        <div class="container-flex-row">
            <div class="section section-help bg-color-alpha" style="width:30%">
                <div class="section-title" >
                    <div class="dot"></div> TEST RESULTS
                </div>
                <div class="section-content" >


                    List of the results of running each test for the current function; passing tests are green and failing tests are red. If you think a failing test is wrong (i.e., the test improperly specifies the expected output), you can <strong>report an issue</strong> with the test (but you can report an issue with only one test).

                    <button ng-click="runTests()" class="btn btn-primary"  ng-disabled="testsRunning || microtaskForm.$invalid ">Run the tests!</button>
                </div>
            </div>
            
            <div class="section section-form" style="width:70%;">
                <div class="section-content no-padding" >

                    <div class="panel-group" ng-model="activePanel" bs-collapse>

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <strong ng-if="testsRunning"> 
                                    Tests are running... please wait. 
                                    <span ng-if="total!=0">({{completed}}/{{total}})</span>
                                </strong>
                                <strong ng-if="!testsRunning"> 
                                    {{numPassed}}/{{total}} passed tests 
                                </strong>  
                                <span class="pull-right">
                                    <input type="checkbox" ng-model="hidePassedTests" /> hide passed tests
                                </span>
                                <span class="clearfix"></span>
                            </div>
                        </div>
                        <div class="panel panel-default panel-test-result {{ ! test.ready() ? '' : ( test.output.result?'panel-success':'panel-danger' ) }}" 
                            ng-repeat="(testIndex,test) in tests track by $index"
                            ng-show="!test.output.result || !hidePassedTests">
                            <div class="panel-heading" bs-collapse-toggle>
                                <strong class="pull-left">    
                                    Test case #{{::(testIndex+1)}} :
                                    {{data.test.rec.description}} 
                                </strong>
                                <span class="pull-right">executed in {{test.executionTime}} ms</span>
                                <span class="clearfix"></span>
                            </div>
                            <div class="panel-collapse" bs-collapse-target>
                                <div ng-if="activePanel != NaN && (activePanel%tests.length)==$index">

                                    <div class="panel-body" ng-if="test.errors != undefined ">
                                        Some errors has been found while running this test: <br />
                                        <strong>{{test.errors}}</strong>
                                    </div>

                                    <div class="heading">Test Data</div>
                                    <div>
                                        <div class="heading-1" >Input Parameters</div>
                                        <table>
                                            <tr ng-repeat="(key,input) in test.rec.simpleTestInputs track by $index">
                                                <td>{{ paramNames[key] }}</td>
                                                <td>
                                                    <div ace-read-json ng-model="input" ></div>
                                                </td>
                                            </tr>
                                        </table>

                                        <div class="heading-1" >Output</div>

                                        <div ng-if="test.output.result" ace-read-json ng-model="test.output.actual" ></div>
                                        


                                        <div ng-if="!test.output.result">
                                            <table>
                                                <tr>
                                                    <td>expected</td>
                                                    <td>
                                                        <div ace-read-json ng-model="test.output.expected" ></div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>actual</td>
                                                    <td>
                                                        <div ace-read-json ng-model="test.output.actual" ></div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>

                                        <div ng-if="test.debug != ''">
                                            <div class="heading-1">Debug Console</div>
                                            <div ace-read-string ng-model="test.debug" ></div>
                                        </div>
<!--
                                        <div class="heading-1">
                                            <span class="pull-right">
                                                <a ng-if="!test.output.result" 
                                                    ng-click="$emit('disputeTest',testIndex);"> Report an issue with the data of this test</a>
                                            </span>
                                            <span class="clearfix"></span>

                                        </div>
-->

                                    </div>
                                    <br />
                                   
                                    <div  ng-if=" test.stubMap != {} " >
                                        <div class="heading" >Stubs</div>
                                        <div class="panel panel-default" ng-repeat="(fName,fStubs) in test.stubMap">
                                            <div class="panel-heading">
                                                The function 
                                                <ace-read-js code="calleDescription[fName].code"></ace-read-js>
                                                has been called with {{ ::fStubs | keylength }}  {{ ::(fStubs | keylength) > 1 ? 'different sets':'set' }} of inputs.
                                                <br />
                                                For each set of inputs, you can choose what return value to use ( you can <b>stub</b> the function for the given input values ).
                                            </div>
                                            <div class="heading-1" ng-repeat-start="(inputKey,stub) in fStubs track by $index">Input set {{$index}}</div>
                                            <table ng-repeat-end>
                                                <tr ng-repeat="(key,input) in stubs[fName][inputKey].inputs track by $index" >
                                                    <td>{{stubsParamNames[fName][$index]}}<br /></td>
                                                    <td><div ace-read-json ng-model="input" ></div></td>
                                                </tr>

                                                <tr>
                                                    <td>return value</td>
                                                    <td><div ace-edit-json ng-model="stubs[fName][inputKey].output" ></div></td>
                                                </tr>
                                            </table>
                                
                                        </div>
                                    </div>
                                       
                                </div>
                            </div>
                        </div>

                    </div>                    
                </div>
            </div>
        </div>
    </div>
<!--
    <div class="section-cols" ng-if=" stubs && !dispute">
        <div class="container-flex-row">
            <div class="section section-help" style="width:30%">
                <div class="section-title" >
                    FUNCTION CALL STUBS
                </div>
                <div class="section-content" >
                    <p>
                    For each function called by operation, you can choose the output that the function will produce for each set of inputs with which is called. When you change the output of a function, the test runner will automatically create a <strong>stub</strong>, using the output you specify instead of executing the actual function call.
                    </p>
                </div>
            </div>
            <div class="section section-form"  style="width:70%" >
                <div class="section-title" >

                </div>
                <div class="section-content" >

                    <ul style="list-style:none;margin:0px;padding:0px;">
                        <li ng-repeat="(callee,inputMap) in stubs track by $index" >
                            The function <b>{{callee}}</b> 
                            <ace-read-js code="calleDescription[callee].code"></ace-read-js>
                            Has been called with {{ inputMap | keylength }}  {{ (inputMap | keylength) > 1 ? 'different sets':'set' }} of inputs
                            <ul class="collapsable-list mock-collapsable-list ">
                                <li ng-repeat="(stubKey,stub) in inputMap track by $index">
                                    <b>#{{$index+1}} input set </b><br />
                                    
                                    <table style="width:100%">
                                        <tr ng-repeat="(key,input) in stub.inputs track by $index">
                                            <td>{{stubsParamNames[callee][$index]}}<br /></td>
                                            <td><div ace-read-json ng-model="input" ></div></td>
                                        </tr>
                                        <tr>
                                            <td>output</td>
                                            <td><div ace-edit-json ng-model="stub.output" ></div></td>
                                        </tr>
                                    </table>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

-->
    <div class="section-cols" ng-if=" !dispute ">
        <div class="container-flex-row">
            <div class="section section-help bg-color-alpha " style="width:30%">
                <div class="section-title" >
                    <div class="dot"></div> FUNCTION EDITOR
                </div>
                <div class="section-content" >
                    <p>
                    For monitoring statements, use <strong>debug.log(statement)</strong>. The results of the debug.log() are printed below each <strong>test result</strong>.
                    </p>
                </div>
                <div class="section-title" > AVAILABLE DATA TYPES </div>
                <div class="section-content" >
                    <adt-list></adt-list>
                </div>
            </div>
            <div class="section section-form" style="width:70%">
                <div class="section-content no-padding" >
                    <div ui-codemirror="{ onLoad : codemirrorLoaded, autofocus : true }" ng-model="code" focus></div>
                    <textarea function-validator class="form-control" name="code" ng-model="code" ng-show="false"></textarea>
                    <ul class="help-block pull-left" ng-if="microtaskForm.code.$error.function_errors.length > 0">
                        <ul ng-repeat="error in microtaskForm.code.$error.function_errors track by $id($index)">
                            <li>{{error}}</li>
                        </ul>
                    </ul>
                    <javascript-helper class="pull-right"></javascript-helper>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="section section-form" ng-if="dispute">
        <div class="section-title" >
            DISPUTE TEST
        </div>
        <div class="section-content" >
            <span><b>Test description:</b> {{disputedTest.rec.description}}</span><br/>
            <span><b>Test code:</b> {{disputedTest.rec.code}}</span><br/>
            <label for="disputeDescription">What's wrong with this test? </label>
            <textarea name="disputeDescription" class="form-control" ng-model="disp.disputeText" ng-required="dispute" ng-pattern="/^[^/\\\'\&quot;]+$/"></textarea>
            <ul class="help-block" ng-show="microtaskForm.disputeDescription.$dirty && microtaskForm.disputeDescription.$invalid">
                <li ng-show="microtaskForm.disputeDescription.$error.required">This field is required!</li>
                <li ng-show="microtaskForm.disputeDescription.$error.pattern">The symbols \ / " 'are not allowed</li>
            </ul>
            <br>
            <button class="btn" ng-click="cancelDispute()" >Nothing is wrong with the test</button>
        </div>
    </div>
    <!--
    <div class="task-buttons pull-right">
        <button ng-click="submit()" class="btn btn-primary" ng-disabled="form.$invalid || passedTests.length != tests.length" >Submit</button>
        <button ng-click="$emit('skipMicrotask')"   class="btn btn-link"   >Skip</button>
    </div>
    <div class="clearfix"></div>
    -->
</div>