
<div ng-controller="DebugTestFailureController" class="task-container container-flex-column">

	<div class="section section-description " >
		<div class="section-content no-padding" >
			<ul class="microtask-details clearfix">
				<li>{{datas.title}}</li>
				<li>
					<span>{{datas.submitValue}} points</span>
				</li>
				<li>
					<div class="help-btn"><span class="glyphicon glyphicon-question-sign"></span></div>
				</li>
			</ul>
		</div>
	</div>



	<div class="section section-form">
		<div class="section-title" >
		FUNCTION EDITOR
		</div>
		<div class="section-content" >
			<function-convections></function-convections>
	 	
			<div ui-codemirror="{ onLoad : codemirrorLoaded, autofocus : true }" ng-model="code" focus></div>
			<textarea function-validator class="form-control" name="code" ng-model="code" ng-show="false"></textarea>
			<ul class="help-block" ng-show="microtaskForm.code.$error.function_errors.length > 0">
				<span>There are some errors. Please fix them before submit:</span>
				<ul ng-repeat="error in microtaskForm.code.$error.function_errors track by $id($index)">
					<li>{{error}}</li>
				</ul>
			</ul>
			<ng-include src="'/html/templates/java_tutorial.html'"></ng-include>
			<span class="clearfix"></span>
		</div>
	</div>

	<div class="section section-form" ng-if=" !dispute && ( stubs | keylength )">
		<div class="section-title" >
		CALLEE STUBS 
		</div>
		<div class="section-content" >
			<ul class="collapsable-list ">
				<li ng-repeat="(callee,inputMap) in stubs" > 
					the function <b>{{callee}}</b> has been called with {{ inputMap | keylength }}  {{ (inputMap | keylength) > 1 ? 'different sets':'set' }} of inputs
					<ul class="collapsable-list ">
						<li ng-repeat="(stubKey,stub) in inputMap track by $index">
							<b>Input set {{$index+1}} </b><br />
							<table style="width:100%">
								
								<tr ng-repeat="(inputKey,input) in stub.inputs">
									<td>input {{inputKey}}</td>
									<td>
										<div ace-read-json ng-model="input" ></div>
									</td>
								</tr>
								<tr>
									<td>stub output</td>
									<td>
										<div ace-read-json ng-model="stub.stubOutput" ></div>
										<input ng-model="stub.stubOutput" />
									</td>
								</tr>
								<tr ng-if="stub.stubOutput != stub.realOutput">
									<td>real output</td>
									<td><div ace-read-json ng-model="stub.realOutput" ></div></td>
								</tr>
							</table>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	

	<div class="section section-form" ng-if="!dispute">
		<div class="section-title" >
			TESTS RESULT
		</div>
		<div class="section-content" >

			<collapsable-list
			    data="results" 
			    class="test-collapsable-list"
			    list-element-class-condition="'success': data.testResult , 'failed': ! data.testResult "
				toggler-template="/html/templates/collapsable_toggler_test.html"
				element-template="/html/templates/collapsable_element_test.html">
			</collapsable-list>

			<button ng-click="runTests()" class="btn btn-primary"  >Run the tests!</button>
			<br/>
		</div>
	</div>

	<div class="section section-form" ng-if="dispute">
		<div class="section-title" >
			DISPUTE TEST 
		</div>
		<div class="section-content" >
 			<span><b>Test description:</b> {{disputedTest.description}}</span><br/>
			<span><b>Test code:</b> {{disputedTest.code}}</span><br/>

			<label for="disputeText">What's wrong with this test? </label>
			<textarea name="disputeText" class="form-control" ng-model="disputedTest.disputeText"></textarea><br>
			<button class="btn" ng-click="cancelDispute()" >Nothing is wrong with the test</button>
		</div>
	</div>
<!--
	<div class="task-buttons pull-right">
		<button ng-click="submit()" class="btn btn-primary" ng-disabled="form.$invalid || passedTests.length != tests.length" >Submit</button>
		<button ng-click="$emit('skipMicrotask')"   class="btn btn-link"   >Skip</button>
	</div>
	<div class="clearfix"></div>
-->
</div>