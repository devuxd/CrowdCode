<div class="modal microtask-detail" tabindex="-1" role="dialog" >
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" ng-click="$hide()">&times;</button>
				<h4 class="modal-title">Microtask #{{task.data.id }} ( {{task.$id}} )</h4>
			</div>
			<div class="modal-body" style="" ng-init="data=task.data">
				<ul class="list-group">
					<li class="list-group-item">
						Type
						<strong class="pull-right" ng-bind="task.data.type"></strong>
						<span class="clearfix"></span>
					</li>
					<li ng-if="data.promptType != undefined" class="list-group-item">
						Prompt type
						<strong class="pull-right" ng-bind="task.data.promptType"></strong>
						<span class="clearfix"></span>
					</li>
					<li class="list-group-item">
						Status
						<strong class="pull-right" ng-bind="task.status"></strong>
						<span class="clearfix"></span>
					</li>
					<li class="list-group-item" ng-if="task.status != 'spawned' && task.status != 'assigned'">
						Completition Time
						<strong class="pull-right" ng-bind="task.completedIn | amountOfTime "></strong>
						<span class="clearfix"></span>
					</li>
					<li class="list-group-item" ng-if="task.status != 'spawned'">
						Worker
						<strong class="pull-right" ng-bind="data.workerHandle"></strong></span>
						<span class="clearfix"></span>
					</li>

					<li class="list-group-item">
						Artifact
						<strong class="pull-right" ng-bind="data.owningArtifact"></strong>
						<span class="clearfix"></span>
					</li>

					<ng-if="task.status != 'spawned' && task.status != 'assigned' && task.status != 'skipped'" 
						ng-init="submission = data.submission">

					<li class="list-group-item">
						Submitted work: 
					</li>

					<li class="list-group-item" ng-if="data.type == 'WriteFunction'">
						<div  
							class="ace-editor" 
							ui-ace="{ onLoad : aceLoaded, mode: 'javascript', theme:'xcode', useWrapMode : true  }" 
							readonly="readonly" 
							ng-model="submission.code">
						</div>

						<b>Pseudo Functions</b>
						<div ng-repeat="f in submission.pseudoFunctions"
							class="ace-editor" 
							ui-ace="{ onLoad : aceLoaded, mode: 'javascript', theme:'xcode', useWrapMode : true  }" 
							readonly="readonly" 
							ng-model="f.description">
						</div>
						
					</li>

					<li class="list-group-item" ng-if="data.type == 'DebugTestFailure'">
						<div ng-if="submission.disputeText.length == 0" class="ace-editor" ui-ace="{ onLoad : aceLoaded, mode: 'javascript', theme:'xcode', useWrapMode : true  }" readonly="readonly" ng-model="submission.code"></div>


						<div ng-if="submission.disputeText.length > 0" >
							test disputed 
							<pre ng-bind="submission.disputeText"></pre>
						</div>
					</li>

					<li class="list-group-item" ng-if="data.type == 'ReuseSearch'">
						search a function that can substitute the pseudocall 
						<pre ng-bind="data.callDescription"></pre>
						requested in the function 
						<strong ng-bind="data.owningArtifact"></strong>
						and he choose <br />
						<pre ng-if="submission.noFunction">no function does this</pre>
						<pre ng-if="!submission.noFunction" >{{submission.functionName}}</pre>

					</li>

					<li class="list-group-item" ng-if="data.type == 'WriteCall'">
						substitute the pseudocall 
						<pre >//!{{data.pseudoCall}}</pre>
						<div class="ace-editor" ui-ace="{ onLoad : aceLoaded, mode: 'javascript', theme:'xcode', useWrapMode : true  }" readonly="readonly" ng-model="submission.code"></div>
					</li>

					<li class="list-group-item"  ng-if="data.type == 'WriteFunctionDescription'">
						<span> call to substitute:  <strong ng-class="pull-right" ng-bind="data.callDescription"></strong></span>
						<table class="table">
							<tr>
								<th>description</th>
								<td>{{submission.description}}</td>
							</tr>
							<tr>
								<th>header</th>
								<td>{{submission.header}}</td>
							</tr>
							<tr>
								<th colspan="2">params</th>
							</tr>
							<tr ng-repeat="(index,name) in submission.paramNames">
								<th>
									{{name}} 
								</th>
								<td>
									{{submission.paramTypes[index]}}<br />
									{{submission.paramDescriptions[index]}}
								</td>
							</tr>
							<tr>
								<th>
									return type
								</th>
								<td>
									{{submission.returnType}} 
								</td>
							</tr>
						</table>

					</li>

					<li class="list-group-item" ng-if="data.type == 'WriteTestCases' && data.disputeDescription.length > 0">
						Disputed test case 
						<strong class="pull-right" ng-bind="data.disputedTestCase"></strong>
						<span class="clearfix"></span>
					</li>
					<li class="list-group-item" ng-if="data.type == 'WriteTestCases' && data.disputeDescription.length > 0">
						Dispute description
						<strong class="pull-right" ng-bind="data.disputeDescription"></strong>
						<span class="clearfix"></span>
					</li>
					<li class="list-group-item"  ng-if="data.type == 'WriteTestCases'">

						<ul  if="submission.isFunctionDispute">
							<li ng-repeat="testcase in submission.testCases" class="testcase.added ? 'added' : testcase.removed? 'removed' : ''" ng-bind="testcase.text"></li>
						</ul>
						<div if="!submission.isFunctionDispute" >
							Function signature disputed 
							<pre ng-bind="submission.disputeText"></pre>
						</div>
					</li>

					<li class="list-group-item"  ng-if="data.type == 'WriteTest'">

						<div ng-if="data.promptType == 'FUNCTION_CHANGED'">
							<span> Diff of the function signature </span>

							<div class="ace-editor" 
								ui-ace="{ onLoad : aceLoaded , mode: 'diff', theme:'xcode', showGutter: false }" 
								readonly="readonly" 
								ng-model="descriptionDiff"
							></div>
						</div>

						<div ng-if="data.promptType == 'TESTCASE_CHANGED'">
							<span> Diff of the testcase description </span>

							<div class="ace-editor" 
								ui-ace="{ onLoad : aceLoaded , mode: 'diff', theme:'xcode', showGutter: false }" 
								readonly="readonly" 
								ng-model="descriptionDiff"
							></div>
						</div>

						<div ng-if=" data.promptType == 'WRITE' || data.promptType == 'CORRECT' ">
							<pre>{{function.description}}</pre>
						</div>


						<table ng-if=" submission.disputeText.length == 0 " class="table">
							<tr >
								<th colspan="2">Inputs</th>
							</tr>
							<tr ng-repeat="name in function.paramNames track by $index" >
								<th style="width:20%">{{name}} ({{function.paramTypes[$index]}})</th>
								<td>
									<div class="ace-editor" 
										ui-ace="{ onLoad : aceLoaded , mode: 'json', theme:'xcode', showGutter: false }" 
										readonly="readonly" 
										ng-model="submission.simpleTestInputs[$index]"
									></div>
								</td>
							</tr>

							<tr>
								<th >Output  (<span ng-bind="function.returnType"></span>) </th>
								<td>
									<div class="ace-editor" 
										ui-ace="{ onLoad : aceLoaded , mode: 'json', theme:'xcode', showGutter: false }" 
										readonly="readonly" 
										ng-model="submission.simpleTestOutput"
									></div>
								</td>
							</tr>
						</table>

						<div ng-if="submission.inDispute" >
							test case disputed 
							<pre ng-bind="submission.disputeText"></pre>
						</div>

						<div ng-if="submission.isFunctionDispute" >
							Function signature disputed 
							<pre ng-bind="submission.disputeText"></pre>
						</div>


					</li>

					</ng-if>

					<li class="list-group-item" ng-if="data.review != undefined" ng-init="review = data.review">
						This work has been 
						<strong ng-if="review.qualityScore<3">rejected</strong>
						<strong ng-if="review.qualityScore==3">reissued</strong>
						<strong ng-if="review.qualityScore>3">approved</strong>
						with 
						<span>{{review.qualityScore}} stars</span>
						<span ng-if="review.reviewText.length == 0">
							and <strong>no comments</strong>
						</span>
						<span ng-if="review.reviewText.length > 0">
							<br />
							<pre ng-bind="review.reviewText"></pre>
						</span>
					</li>
				</ul>
				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" ng-click="$hide()">Close</button>
			</div>
		</div>
	</div>
</div>